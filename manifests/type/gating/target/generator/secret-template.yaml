apiVersion: airshipit.org/v1alpha1
kind: Templater
metadata:
  name: secret-template
  annotations:
    config.kubernetes.io/function: |
      container:
        image: quay.io/airshipit/templater:latest
values:
  targetClusterCa:
    cn: "Kubernetes API"
    validity: 3650
template: |
  apiVersion: airshipit.org/v1alpha1
  kind: VariableCatalogue
  metadata:
    labels:
      airshipit.org/deploy-k8s: "false"
    name: generated-secrets
    annotations:
      config.kubernetes.io/path: secrets.yaml
  {{- $targetClusterCa:=genCA .targetClusterCa.cn .targetClusterCa.validity }}
  {{- $targetKubeconfigCert:= genSignedCert "Kubernetes API" nil nil 365 $targetClusterCa }}
  targetClusterCa:
    tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFekNDQWZ1Z0F3SUJBZ0lVTi96S0R5dXBjV2I1U1hzNFpJRkRxNkptZlpZd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0dURVhNQlVHQTFVRUF3d09TM1ZpWlhKdVpYUmxjeUJCVUVrd0hoY05NakV3TVRJek1EUXdNelUwV2hjTgpNekV3TVRJeE1EUXdNelUwV2pBWk1SY3dGUVlEVlFRRERBNUxkV0psY201bGRHVnpJRUZRU1RDQ0FTSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU5rZHNFS29YNXVCNm5XZmZQUjlXY0U4NWxHRTUxM1AKeWJQU1VlWVVsWGMwSzBsNlNtSGNqWUdnTjZNMG8zTnIwSVdGZWFBZkpLN29wa3BkMUQ2clVzN3JFNDJyR0h0ZApLYUVKRXNRK0pHVEtaZmpTMktVdDc1a0RCaTRnNHBQSXFzSFlHMnIrQVZncUx2TGQvMUJ5NU90Nm1jV2FqTXJNCjdDckhiTzl1cVFmd21kMCtUdy9FY2JRTStLNU9WdmlvZDdnbWZZNWZJYXNka1BGdEJoeHY4QTl2SUpVQm00bUMKV3FmZ2FaQWNpQlpLejBNdld2Wno2SmFobkl5Y0hQeDdXLzA2QU11cG9SSUg4bWw3cWhGaGxEUHlscGF4bXhOWApnSCtHZ3hlVGdPb1BYUVlkK0szcnlRd01DMGQzSDdqY3VjRjdpOXp1MmJyVW5zaHVRNWlaSHdrQ0F3RUFBYU5UCk1GRXdIUVlEVlIwT0JCWUVGQytUbXppb0hLd2MxY3BLT1NERzQzYUNDdnJmTUI4R0ExVWRJd1FZTUJhQUZDK1QKbXppb0hLd2MxY3BLT1NERzQzYUNDdnJmTUE4R0ExVWRFd0VCL3dRRk1BTUJBZjh3RFFZSktvWklodmNOQVFFTApCUUFEZ2dFQkFJbER5eEhxa241Mjl0NHJ0VkQ1YTVnVThjakZTQ3NVb3QvODcrQXhWNTIxTHZ4TVFzV0JtSUhlClkvSldXNllIK2xWVzVhSERlZDBaTk51Rk1zTG11MzF4eHQ5bUlua05QSUVUcTVRTVZyNXBFazB5QmlOeWw1dlcKKzU0ZjcwaGNMSGdCSXhTQSs1OVlFQnM2YTQvM2Uzb0IxbXpBOEZNampUNDlwVXpoTTlpRkdOY3BLYlJxT2ZQagpFeHVnSXd2R0kvV0xtYllqR3dLR1dra1hYOW12MndrSjFvNjRJWmJ2N0pKYkhiUlpTTzRPZVFGVS9yanNIUjNjCmU1WVRWRzNTNlkwQVNZZjFvL3EvT29BUmNDSENrU0RvcEk5UlMyVVBnMjh0dmFLam5rT09sVFhndlNxK1hlQ1oKOC9zU1NoWW42b3RndFQrMjhaMGR3OVFOdXVxbDVhYz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    #{{ $targetClusterCa.Cert|b64enc|quote }}
    tls.key: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRRFpIYkJDcUYrYmdlcDEKbjN6MGZWbkJQT1pSaE9kZHo4bXowbEhtRkpWM05DdEpla3BoM0kyQm9EZWpOS056YTlDRmhYbWdIeVN1NktaSwpYZFErcTFMTzZ4T05xeGg3WFNtaENSTEVQaVJreW1YNDB0aWxMZStaQXdZdUlPS1R5S3JCMkJ0cS9nRllLaTd5CjNmOVFjdVRyZXBuRm1vekt6T3dxeDJ6dmJxa0g4Sm5kUGs4UHhIRzBEUGl1VGxiNHFIZTRKbjJPWHlHckhaRHgKYlFZY2IvQVBieUNWQVp1SmdscW40R21RSElnV1NzOURMMXIyYytpV29aeU1uQno4ZTF2OU9nRExxYUVTQi9KcAplNm9SWVpRejhwYVdzWnNUVjRCL2hvTVhrNERxRDEwR0hmaXQ2OGtNREF0SGR4KzQzTG5CZTR2Yzd0bTYxSjdJCmJrT1ltUjhKQWdNQkFBRUNnZ0VBUmFjNW9kamtlejR0bXJpazNNYk9JYWxJOW9RZHVjSHNvcXpwcTFlVkw5M2oKdVRuclhRUGx2ZDFKbkNsSitzQnU4RGNHOHZDcTB4WStLd041RVBYanBoQlNnSk9RVWh0c1BJWnRwOW1MMFc0QgpVdGRKdTR4R0hwK1N2dis3ME0rQ3dKZDFERmthMDA4Tktzcy9tbTZSdEYzcnNUSkkwdEwxUFRBbmFaVGwwMjZzCkhjRVpxbkRBRVlFT0t3eGN1TzYwK1JaQkxicTQ2Wm5TaUdDNVJHbERLQmlMOU1mQ0NsRVdEMi9lMUt4S0JTUjcKbXVWcXdpQ1AyUU9ZZHlDZ1Y5Y2JmOXJ5aVI3aUtQL3UrbEJpcVlrbDNlUXVEMEFjMjZoWUxpTVh3TGVBdVVZMwplb2VSVFpTWS8vM3lHblpkOGVuOXBVUlNtUzMvNGxTSURzelVVdEtXMFFLQmdRRC9WTUFUdlN2d2htNGFUR2p0CkdNNTkyZXFZTXJvNmluUVRXSjkzek1tdzB4Mm83V0QzMXc0L3BUdng2RzlCSFZQNUl5RXZoWmtHQ3RHdE42ZmQKemsvbG13U1l5VDNNTmlEMUx1UDNSWkRBUG9uckJmdURETFpwaHJFeDZLbExITndtclpVckFSRWFuTXBrdlpNaApQK2V5ZmhXUnFYOVROSWIzZXBUV2RTakZkUUtCZ1FEWnIwNjNSNXVncktPUGQvYjVZSDltYTJNcEJTV3VMVFRoCkxvcEFXOTRkblFZRElHM0xjMlNBNUg3ZFhkUDlDT0pmSmlyY1NsT0plK2V2TkU4bG5nWm9JMkFIbGtmK2dKVFEKVWlMeGQ0WVRJSXc4bityQTd4UVU2SXo0QWpuVjhWbnNPTGZPQTZ1UXdTbzVDUHBPd2VxWlVyMlBrZHBrcnYyTApBK2Z0S1RMOHhRS0JnQnozZFc4SDJCTktmUFU0MC9LS0RPc1VMTndsYlNFMUVlUWIrc054bFRRZFQxRVoxUlZvCjdYSGxBZjc0dXA1dGdGaFVWdkI0UEpzRjRUSEFqYWZKUHlFeVMvdzFZSEJwZDZXNU14MmJZOGVia0xQOEVzT1UKVHFGOEtXQWJJQkdvYllWcHpmRjZCb0c1WmZDMTNSbzVrTVNjTDBBK05YYXdEOXZGcVZzSElaLzlBb0dBR1p2MApLTCsxNFZzdUNzelVNMVpVNXBtdm1yM09Sd1Z1ZVNkZWdGL09hN0Z6YVo3QkMvUlJXSkNKRkVYYmtLTWc3b3l3CjhpV1VXbEpIV1dkUUFGN3M1Z2R6WHJFaFd5R0pZRkNwWjdybC9RNFJNWGlteDNmWTV2VE0wTWlDUVZjWmV4N1oKRU5XQnM0L21CYnUycHRsTlhpaEx3TDRwOFRwYy9hUEIvemFmbHZrQ2dZRUFpUUlLTTlUK1dpM2F0a2RqYWhrdQp6V3JuSGswQWNVazBTZWlHNHV4OENKeG8vZnVvSmtIUmxMaUNzSU1TWC91K1hYeWxEaVZwK29YR0x0bHgxYktjCnJNN2hOYlBJdGJaTkhueWdDNlAzY0h1MDJpaU1KZkZ3RkNzV2dzd0lPYlJrTkgxZ0JWZUE5bjV4MFlQSWhmbkkKQVV4d0RpZGwzdytuNlB0VDM2Q2R4MFE9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K
    #{{ $targetClusterCa.Key|b64enc|quote }}
  targetKubeconfig:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFekNDQWZ1Z0F3SUJBZ0lVTi96S0R5dXBjV2I1U1hzNFpJRkRxNkptZlpZd0RRWUpLb1pJaHZjTkFRRUwKQlFBd0dURVhNQlVHQTFVRUF3d09TM1ZpWlhKdVpYUmxjeUJCVUVrd0hoY05NakV3TVRJek1EUXdNelUwV2hjTgpNekV3TVRJeE1EUXdNelUwV2pBWk1SY3dGUVlEVlFRRERBNUxkV0psY201bGRHVnpJRUZRU1RDQ0FTSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU5rZHNFS29YNXVCNm5XZmZQUjlXY0U4NWxHRTUxM1AKeWJQU1VlWVVsWGMwSzBsNlNtSGNqWUdnTjZNMG8zTnIwSVdGZWFBZkpLN29wa3BkMUQ2clVzN3JFNDJyR0h0ZApLYUVKRXNRK0pHVEtaZmpTMktVdDc1a0RCaTRnNHBQSXFzSFlHMnIrQVZncUx2TGQvMUJ5NU90Nm1jV2FqTXJNCjdDckhiTzl1cVFmd21kMCtUdy9FY2JRTStLNU9WdmlvZDdnbWZZNWZJYXNka1BGdEJoeHY4QTl2SUpVQm00bUMKV3FmZ2FaQWNpQlpLejBNdld2Wno2SmFobkl5Y0hQeDdXLzA2QU11cG9SSUg4bWw3cWhGaGxEUHlscGF4bXhOWApnSCtHZ3hlVGdPb1BYUVlkK0szcnlRd01DMGQzSDdqY3VjRjdpOXp1MmJyVW5zaHVRNWlaSHdrQ0F3RUFBYU5UCk1GRXdIUVlEVlIwT0JCWUVGQytUbXppb0hLd2MxY3BLT1NERzQzYUNDdnJmTUI4R0ExVWRJd1FZTUJhQUZDK1QKbXppb0hLd2MxY3BLT1NERzQzYUNDdnJmTUE4R0ExVWRFd0VCL3dRRk1BTUJBZjh3RFFZSktvWklodmNOQVFFTApCUUFEZ2dFQkFJbER5eEhxa241Mjl0NHJ0VkQ1YTVnVThjakZTQ3NVb3QvODcrQXhWNTIxTHZ4TVFzV0JtSUhlClkvSldXNllIK2xWVzVhSERlZDBaTk51Rk1zTG11MzF4eHQ5bUlua05QSUVUcTVRTVZyNXBFazB5QmlOeWw1dlcKKzU0ZjcwaGNMSGdCSXhTQSs1OVlFQnM2YTQvM2Uzb0IxbXpBOEZNampUNDlwVXpoTTlpRkdOY3BLYlJxT2ZQagpFeHVnSXd2R0kvV0xtYllqR3dLR1dra1hYOW12MndrSjFvNjRJWmJ2N0pKYkhiUlpTTzRPZVFGVS9yanNIUjNjCmU1WVRWRzNTNlkwQVNZZjFvL3EvT29BUmNDSENrU0RvcEk5UlMyVVBnMjh0dmFLam5rT09sVFhndlNxK1hlQ1oKOC9zU1NoWW42b3RndFQrMjhaMGR3OVFOdXVxbDVhYz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    #{{ $targetClusterCa.Cert|b64enc|quote }}
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5VENDQWJFQ0ZIdWVIQndXSmtraXpIamJ6WEQ1ajZzaXdiRGlNQTBHQ1NxR1NJYjNEUUVCQ3dVQU1Ca3gKRnpBVkJnTlZCQU1NRGt0MVltVnlibVYwWlhNZ1FWQkpNQjRYRFRJeE1ERXlNekEzTVRjME1sb1hEVEl4TURFeQpPREEzTVRjME1sb3dLVEVPTUF3R0ExVUVBd3dGWVdSdGFXNHhGekFWQmdOVkJBb01Ebk41YzNSbGJUcHRZWE4wClpYSnpNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTIxMVkzTHZMUzZLSE5lQWcKM3l1cFlYNWJRQjlDZlFvWU1tSENPUGppSTRwUVBmb3libks0WmFuenBvZFA2STJ2TFg0ODF1Mi9WcXRFQVVVVAp3a2ZSNkcxTmtjOVoycTlkUWZWNnM5dGNLcjd6d1lrc3hyWkQ0Tm52K2lNK2I4US9qeDNGb0hZSGFhWWNDd0VSCjBadlZoaFIwTldFMEpRYnVEYTFZZzFEUFRlZ2tML1BXOVFhRkY5elZIUDZLcFhlTFNTYUZid3U1cTQvOStlVWEKNmNyVDJQbksyWUdIZFpxeEU5cXhuMFpoOEM2dXBtbGtWR3BkTjI3TzZqSm1VSjBSYUUreklCSGdOMjhiWW53RApMVzZkck5iMUJGLzViMk1jRDFlRmwxMk5XcHF1bklHLzREbUo5dUpuQksvODRqdGpkQ2JlWjh6UnNOQXpDdnlICkRFT1JDUUlEQVFBQk1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQ3o1MFpsZTN4UjJ2QjVPSkk2eFc3WjQzQzIKUHVKNjViL2FOQjhGSVFBRnlCNkllTHMzcUxEdjBOV3YwQ0puMlNSZ2x2WXFtOFdMZUVwenR6YStGVUFvYzRMdgpKUGpZOVVpR0FaU1ArSThhM3Q4amR3T0dMNG1uSEN2dk9IREMxMzlpeTA3ZHkrQllnZEZiZkRReFJHdnZ6MnZlCnRJMjBHaHRQdzJmOHFBME9abXk1c1J2KzZwbHUyK2RyYlJLekVEZFFjVVFia2xRTEJWN2wybitzeXFaUjdZdzkKeFowQ01QT05TU05Jc0Y3Q0ZoSDdKZWtuTE4ySUxKQzNOZURBZEhXYmdRc01oK3NtTTNyY2d2RC9GSi9QenpLcApQL2d0eEtQRzhOVEJFaUVETElBdjZ6dVlJSXk1TTArbC9PRktxZlluY09MRFhBR0d4aUJaOHRmV3hMT2gKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    #{{ $targetKubeconfigCert.Cert|b64enc|quote }}
    client-key-data: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2d0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktrd2dnU2xBZ0VBQW9JQkFRRGJYVmpjdTh0TG9vYzEKNENEZks2bGhmbHRBSDBKOUNoZ3lZY0k0K09JamlsQTkrakp1Y3JobHFmT21oMC9vamE4dGZqelc3YjlXcTBRQgpSUlBDUjlIb2JVMlJ6MW5hcjExQjlYcXoyMXdxdnZQQmlTekd0a1BnMmUvNkl6NXZ4RCtQSGNXZ2RnZHBwaHdMCkFSSFJtOVdHRkhRMVlUUWxCdTROclZpRFVNOU42Q1F2ODliMUJvVVgzTlVjL29xbGQ0dEpKb1Z2QzdtcmovMzUKNVJycHl0UFkrY3JaZ1lkMW1yRVQyckdmUm1Id0xxNm1hV1JVYWwwM2JzN3FNbVpRblJGb1Q3TWdFZUEzYnh0aQpmQU10YnAyczF2VUVYL2x2WXh3UFY0V1hYWTFhbXE2Y2diL2dPWW4yNG1jRXIvemlPMk4wSnQ1bnpOR3cwRE1LCi9JY01RNUVKQWdNQkFBRUNnZ0VCQU1HTjhmU0I5dlQ3cVZZT05yTHpzWGFHcVRsQTI4ZThlbkVwOU5lVU11U3QKQy9SRHFPL3ZaV2krdG0rL2dQQnU0NXkrZ0N3Y2h2R1FHR2NPYmtyRVdDQS9JV3lBaW9YOHFjcWpNT3MxcUhOSApIWWtzNGtkTFYwVTB4eHZzc1JDcEZuUFBEeXR3T1VZcy9SMXdpaXBxMTlLQWhiRDczYWkySHFJT3k4VENMc2hMClkycVdPSlE5TGtpb3E3a1ZKdWJreE01RHY5akxpYVhkM01UMll1VGp6eWJENVlOSDVTNTEycGpTWjR1OUZOUWoKRjNEYmxCNHV4a3JsYndFOXNoakZNd25mUVc3MlNUWi94KzlIazJwQ0VSbUQxOGtPTTRFWGtRN0J2M012L3Fkdwp6QkFQaUVlaFduNHNwc3dxZVVqZCtWWWt6dGFQejN4Wm5ybzJFdUY1YzZrQ2dZRUEvSGdNTWZEaVZ1U3pUb2RwCkJJeGdoaWQvV25mSFNlWWI4NWs3RExmSDNSc1p6KzhucmJ6M2Zodmw5bUh2alU2UzNvbTkrQWl2ODUzVkZkRnkKRHVYUG9oaHYyM205a0VtRDhVNU50eHI0dGowNXF6am1iOERRNWNiTVBDbWxGcW5qdkwvbWpnZXp2WjJLL00zZQpMMGE5eFQxa3hxZi8yZWtxOUV0ZVNWeDliaDhDZ1lFQTNtN0ZiVkFNaStMbEp2eTJuS0d4ZEpkOWkwTGQ1UTVWCmZhd3o2QVQ4TUxMTE1yNldhU3B0S3BreHgzVXJzTStVYWFrdU1jbmxWZGJJcXcwUGpibjZ1WUZKdi90TGhPK0kKMWs0VzBsMGN1Qk8yaU5kYmFkejlHNFpUSkVwSHBRL2RIZ0UyQ05pUFI4M3lEcUhPdE9YNzR0bkoranQyczZNNwplai9IUkNrM1M5Y0NnWUVBNSsyc1hsQ0l6UVJweURGVEEwK2wrSGZlWVpCNWJtVEt0cnpFWjBtSmZKQkI1U2d4ClRrU3pJNUdqYnZUSEtRdk9sa3I1VGh0RThFckZEcmNLemE3R1VJV2NkSVhnNCtUMUpiOG1XNWlXZEd2SVI0Z04KQVFxam5RSkVhdHhqQVcvdWUxM2JBZzBIVEtDbXB0akVUSy95ODNnVDFQOU9aYlB5dHR0cDhZRGE1VWNDZ1lBSgp6R2xvQ2xtekk5aWlZZ21OVnRZaFk3Y0ZGbm45NkNhOTlZTUgyb2hkZ05MUXRuS2J5V0dydWJubXBuTzVRenV2CmQrTndFQXZKUHoveHdRNkpXTU1CdnY5SHRNTTc1TzFyTzE5bi92QVA3OVpmcXRUOUVkNFlnMDlRVHZGZkJSYmgKaG40aDM2QllNbXRTVjdCcWFhTXgrQlFjc05mbXkrOEgwSjF2bEQwNld3S0JnUUR3MDZtZjBPbjBBZkIwTGlOSwpmVmxSQkhldy9FdlJNdmxpSDlDcmErNDRZbHZ4akQ5YlRxdzBvUWVqaTU1MzlkK1FSdERTSkxaNG8xQkx3M0JrCml5TzRvMDgxYm1mc1lIUjJvekhucncvZUJKZU90a1g5cmxla2dQNXJyaGN4THY4V0pucmgxQmJyQ1JHSEtUMjAKMnhTdmNLaCs2TnNxMjFCVy9qZmlTNUlCNVE9PQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0tCg==
    #{{ $targetKubeconfigCert.Key|b64enc|quote }}
  isoImage:
    passwords:
      root: {{ derivePassword 1 "long" (randAscii 10) "user" "airshipit.org" }}
      deployer: {{ derivePassword 1 "long" (randAscii 10) "user" "airshipit.org" }}
